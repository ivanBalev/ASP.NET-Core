@using BDInSelfLove.Data.Models
@using Microsoft.AspNetCore.Identity
@using BDInSelfLove.Web.InputModels.Forum.Comment

@model BDInSelfLove.Web.ViewModels.Forum.Post.PostViewModel
@inject SignInManager<ApplicationUser> SignInManager

@{
    this.ViewData["width"] = "62";
    this.ViewData["height"] = "62";
}

<div class="row">
    <div class="col-md-12">
       
        <div class="card mb-0 pb-0 border-0" id="0">
            <div class="card-header text-dark p-4">
                <h2 class="h4">@Model.Title</h2>
            </div>
            <div class="card-header bg-white border-0">
                <div class="row">
                    <div class="col-md-2 mb-3 p-0">
                        <button type="button" class="btn btn-outline-primary btn-sm btn-block reply-to-post-button">
                            <i class="ion ion-md-create"></i>Reply
                        </button>
                    </div>
                </div>
                <div class="media flex-wrap w-100 align-items-center">
                    <img src="@(Model.UserProfilePhoto == null ? "https://res.cloudinary.com/dxfq3iotg/image/upload/v1574583246/AAA/2.jpg" : Model.UserProfilePhoto)"
                         height="@this.ViewData["width"]" width="@this.ViewData["height"]"
                         class="d-block rounded-circle" alt="">
                    <div class="media-body ml-3">
                        <a asp-controller="Profile" asp-action="Index" asp-route-username="@Model.UserUserName" class="user-link" data-abc="true">@Model.UserUserName</a>
                        <div class="text-muted small">@Model.CreatedOn.ToString("dd MMMM yyyy HH:mm")</div>
                    </div>
                    <div class="text-muted small ml-3">
                        <div>Member since <strong>@Model.UserCreatedOn.ToString("dd MMMM yyyy HH:mm")</strong></div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                @Html.Raw(@Model.SanitizedContent)
            </div>
        </div>
    </div>
</div>
<hr />
<h5 class="mb-3 ml-4 mt-5">Comments</h5>
@foreach (var comment in Model.Comments)
{
    <partial name="_RecursiveCommentPartial" model="@comment" />
}

<div class="mb-3 clearfix">
    <nav>
        <ul class="pagination justify-content-center">
            @if (this.Model.CurrentPage == 1)
            {
                <li class="page-item disabled">
                    <a class="page-link" href="#">Previous</a>
                </li>
            }
            else
            {
                <li class="page-item">
                    <a class="page-link"
                       asp-area="Forum"
                       asp-controller="Post"
                       asp-action="Index"
                       asp-route-id="@this.Model.Id"
                       asp-route-page="@(this.Model.CurrentPage - 1)">Previous</a>
                </li>
            }

            @for (int i = 1; i <= this.Model.PagesCount; i++)
            {
                var active = i == this.Model.CurrentPage ? "active" : string.Empty;
                <li class="page-item @active">
                    <a class="page-link"
                       asp-area="Forum"
                       asp-controller="Post"
                       asp-action="Index"
                       asp-route-id="@this.Model.Id"
                       asp-route-page="@i">@i</a>
                </li>
            }

            @if (this.Model.CurrentPage == this.Model.PagesCount)
            {
                <li class="page-item disabled">
                    <a class="page-link" href="#">Next</a>
                </li>
            }
            else
            {
                <li class="page-item">
                    <a class="page-link"
                       asp-area="Forum"
                       asp-controller="Post"
                       asp-action="Index"
                       asp-route-id="@this.Model.Id"
                       asp-route-page="@(this.Model.CurrentPage + 1)">Next</a>
                </li>
            }
        </ul>
    </nav>
</div>

@if (!this.SignInManager.IsSignedIn(this.User))
{
    <partial name="_PostLoginPartial" model="null" />
}
else
{
    <partial name="_AddCommentPartial" model="@(new CommentCreateInputModel { ParentPostId = Model.Id })" />
}

@section HeadScripts
{
    <script src="https://cdn.tiny.cloud/1/mky5s0u10p9um2r86zbuod2opxi008rpr3tpgf6dtd16t787/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
    <script>tinymce.init({ selector: '#mytextarea' });</script>
}

@section Scripts
{
    <script src="~/Custom/js/forumComment.js"></script>
}